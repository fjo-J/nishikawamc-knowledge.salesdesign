<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NMC-support tool | 西河マネジメントセンター</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --glow-color1: #34d399;
            --glow-color2: #10b981;
            --glow-color3: #059669;
            --glow-color4: #2dd4bf;
        }
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f0fdf4; /* emerald-50 */
            color: #374151; /* gray-700 */
        }
        .content-section, .program-tab-panel { display: none; }
        .content-section.active, .program-tab-panel.active { display: block; }

        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .aurora-border {
            position: relative;
            overflow: hidden;
            border-radius: 1rem; /* rounded-2xl */
        }
        .aurora-border::before {
            content: '';
            position: absolute;
            top: 0; right: 0; bottom: 0; left: 0;
            z-index: -1;
            margin: -2px;
            border-radius: inherit;
            background: conic-gradient(from 180deg at 50% 50%, 
                var(--glow-color1) 0deg, var(--glow-color2) 72deg, var(--glow-color3) 144deg, 
                var(--glow-color4) 216deg, var(--glow-color1) 288deg, var(--glow-color1) 360deg);
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            animation: aurora-spin 5s linear infinite;
        }
        .aurora-border:hover::before { opacity: 1; }

        @keyframes aurora-spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        #toc a.active {
            color: #059669; /* emerald-600 */
            background-color: rgba(16, 185, 129, 0.1);
            transform: translateX(4px);
        }

        .program-tab.active {
            color: #059669; /* emerald-600 */
            border-image: linear-gradient(to right, var(--glow-color2), var(--glow-color3)) 1;
        }
        
        .transition-all { transition: all 0.3s ease-in-out; }

        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        .ai-chat-bubble, #gemini-response p, #gemini-response ul, #gemini-response h3 {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="glass-card p-4 rounded-2xl shadow-lg mb-8 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-900">NMC-support tool</h1>
                    <p class="text-xs text-gray-500">Nishikawa Management Center</p>
                </div>
            </div>

            <div class="w-full max-w-lg relative">
                 <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <svg class="w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </div>
                <input type="text" id="searchInput" placeholder="ナレッジベースを検索..." class="w-full pl-12 pr-4 py-3 border border-gray-200 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all">
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <aside id="toc-sidebar" class="lg:col-span-1 glass-card p-6 rounded-2xl h-fit sticky top-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4">ナビゲーション</h2>
                <nav id="toc" class="space-y-1">
                </nav>
            </aside>

            <main id="main-content" class="lg:col-span-3 space-y-8">
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="partner-modal" class="modal-overlay fixed inset-0 flex items-center justify-center p-4 hidden z-50 opacity-0 transition-opacity duration-300">
        <div class="modal-content glass-card rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 relative transform scale-95 transition-transform duration-300">
            <button class="modal-close-btn absolute top-4 right-4 text-gray-500 hover:text-gray-900">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <div id="modal-body" class="text-gray-800"></div>
        </div>
    </div>
    <div id="simulator-modal" class="modal-overlay fixed inset-0 flex items-center justify-center p-4 hidden z-50 opacity-0 transition-opacity duration-300">
        <div class="modal-content glass-card rounded-2xl shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto relative transform scale-95 transition-transform duration-300">
             <button id="simulator-close-btn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-900">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <div id="simulator-modal-body" class="p-8 text-gray-800">
            </div>
        </div>
    </div>
    <div id="gemini-modal" class="modal-overlay fixed inset-0 flex items-center justify-center p-4 hidden z-50 opacity-0 transition-opacity duration-300">
        <div class="modal-content glass-card rounded-2xl shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto relative transform scale-95 transition-transform duration-300 flex flex-col">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                 <h2 id="gemini-modal-title" class="text-2xl font-bold text-gray-900">✨ AI 提案アシスタント</h2>
                 <button class="modal-close-btn text-gray-500 hover:text-gray-900">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="p-6 flex-grow overflow-y-auto">
                <div id="gemini-response" class="prose max-w-none text-gray-700"></div>
            </div>
             <div class="p-6 border-t border-gray-200">
                <div class="flex gap-4">
                    <input type="text" id="gemini-input" placeholder="この制度について具体的に質問..." class="flex-grow p-3 border border-gray-300 rounded-md bg-white text-gray-800 focus:ring-emerald-500 focus:border-emerald-500">
                    <button id="gemini-submit" class="bg-gradient-to-r from-emerald-500 to-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:opacity-90 transition-all">送信</button>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- 1. Constants and State ---
            const grantsData = [{id:"jinzai-kaihatsu",type:"joseikin",title:"人材開発支援助成金",purpose:"労働者の職業能力開発を促進するため、事業主が労働者に対して訓練等を実施した場合に、訓練経費や訓練期間中の賃金の一部等を助成する制度。",target:"雇用保険の適用事業主。",keywords:"人材育成, リスキリング, 職業訓練, OJT, OFF-JT"},{id:"gyomukaizen-joseikin",type:"joseikin",title:"業務改善助成金",purpose:"事業場内で最も低い賃金（事業場内最低賃金）を引き上げ、設備投資などを行った場合に、その費用の一部を助成する制度。",target:"事業場内最低賃金と地域別最低賃金の差額が50円以内で、事業場規模100人以下の中小企業・小規模事業者。",keywords:"最低賃金引上げ, 設備投資, 生産性向上, 賃上げ"},{id:"career-up",type:"joseikin",title:"キャリアアップ助成金",purpose:"非正規雇用の労働者の企業内でのキャリアアップを促進するため、正社員化等の取組を実施した事業主に対して助成する制度。",target:"非正規雇用労働者のキャリアアップに取り組む事業主。",keywords:"正社員化, 非正規雇用, 処遇改善, 人材確保"},{id:"it-hojokin",type:"hojokin",title:"IT導入補助金",purpose:"中小企業・小規模事業者の生産性向上を支援するため、ITツール（ソフトウェア、サービス等）の導入費用の一部を補助する制度。",target:"労働生産性の向上を目指す中小企業・小規模事業者。飲食、宿泊、製造、小売など幅広い業種が対象。",keywords:"DX化, デジタル化, ソフトウェア, クラウド利用, インボイス制度"},{id:"monodukuri-hojokin",type:"hojokin",title:"ものづくり補助金",purpose:"革新的な製品・サービスの開発や生産プロセスの改善に必要な設備投資等を支援する制度。",target:"新製品・新サービス開発や、生産性向上に取り組む中小企業・小規模事業者。",keywords:"設備投資, 試作品開発, 新サービス, 生産性向上"}];
            const partnerServiceData = {'modal-marketing':{title:"マーケティング & 営業支援",services:['Sales Marker','Recruit Marker','デジタル広告','営業代行各商材']},'modal-creative':{title:"クリエイティブ & 制作",services:['コンテンツ制作','メールマーケティング']},'modal-consulting':{title:"経営コンサルティング",services:['飲食店コンサルティング','税理サービス']},'modal-lifestyle':{title:"ライフスタイル & その他",services:['旅行代理店','最先端がん診断','内装工事関連','投資対象商材']}};
            // 令和6年度(2024年10月改定)の最新データ
            const minWages = {北海道:1004,青森:953,岩手:950,宮城:963,秋田:951,山形:955,福島:955,茨城:993,栃木:994,群馬:975,埼玉:1072,千葉:1070,東京:1161,神奈川:1156,新潟:973,富山:990,石川:977,福井:973,山梨:980,長野:990,岐阜:993,静岡:1026,愛知:1071,三重:1016,滋賀:1011,京都:1052,大阪:1109,兵庫:1045,奈良:978,和歌山:972,鳥取:955,島根:955,岡山:975,広島:1015,山口:970,徳島:948,香川:962,愛媛:950,高知:950,福岡:987,佐賀:953,長崎:953,熊本:953,大分:953,宮崎:951,鹿児島:952,沖縄:950};
            const gyomukaizenCourses = {
                'large': { '30': { '1': 60, '2-3': 90, '4-6': 120, '7-9': 130, '10+': 130 }, '45': { '1': 80, '2-3': 110, '4-6': 140, '7-9': 160, '10+': 180 }, '60': { '1': 110, '2-3': 160, '4-6': 190, '7-9': 230, '10+': 300 }, '90': { '1': 170, '2-3': 240, '4-6': 290, '7-9': 450, '10+': 600 } },
                'small': { '30': { '1': 30, '2-3': 50, '4-6': 70, '7-9': 100, '10+': 120 }, '45': { '1': 45, '2-3': 70, '4-6': 100, '7-9': 150, '10+': 180 }, '60': { '1': 60, '2-3': 90, '4-6': 150, '7-9': 230, '10+': 300 }, '90': { '1': 90, '2-3': 150, '4-6': 270, '7-9': 450, '10+': 600 } }
            };
            
            const serviceMenuData = {
                'program-point-back': {
                    title: '人材開発支援助成金 / リスキリングスキーム',
                    contextForAI: '人材開発支援助成金（リスキリングスキーム）は、助成金で研修費用を賄い、さらに事業投資に使えるポイントも付与されるプログラムです。実質負担12万円で60万円の研修が受けられ、24万円分のポイントが付きます。',
                    content: `<div class="bg-emerald-50 border border-emerald-200 p-4 rounded-lg"><h3 class="font-bold text-emerald-700">お客様への伝え方ポイント</h3><ul class="list-disc list-inside mt-2 text-emerald-600 text-sm space-y-1"><li>国の助成金を活用するので、<strong>実質12万円の負担</strong>で、従業員に<strong>60万円分</strong>のDX・GX研修を提供できます。</li><li>さらに、実質負担額を上回る<strong>24万円分のポイント</strong>が付与されるので、<strong>差し引き12万円のプラス</strong>になります。</li><li>このポイントを使って、広告やコンサルなど、<strong>事業成長に必要なサービスを実質無料で導入</strong>できます。</li></ul></div><div><h3 class="text-xl font-bold text-gray-900 mb-2">プログラム概要</h3><p>人材開発支援助成金を活用し、従業員のリスキリングと経営投資を同時に実現する当社独自のプログラムです。助成金で研修費用を賄い、さらに事業投資に使えるポイントを受け取ることができます。</p></div><div><h3 class="text-xl font-bold text-gray-900 mb-3">仕組みの図解</h3><div class="w-full overflow-x-auto bg-white p-4 rounded-lg border"><svg viewBox="0 0 800 250" class="w-full min-w-[700px] text-gray-700"><defs><marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#6b7280"/></marker></defs><g transform="translate(100, 75)"><rect x="-70" y="-30" width="140" height="60" rx="10" fill="#f9fafb" stroke="#e5e7eb" stroke-width="1"/><text x="0" y="5" text-anchor="middle" font-weight="bold" fill="#111827">お客様</text></g><g transform="translate(400, 75)"><rect x="-90" y="-30" width="180" height="60" rx="10" fill="#d1fae5" stroke="#6ee7b7" stroke-width="1"/><text x="0" y="5" text-anchor="middle" font-weight="bold" fill="#065f46">当社 (NMC)</text></g><g transform="translate(700, 75)"><rect x="-70" y="-30" width="140" height="60" rx="10" fill="#ccfbf1" stroke="#5eead4" stroke-width="1"/><text x="0" y="5" text-anchor="middle" font-weight="bold" fill="#115e59">国</text></g><g transform="translate(400, 175)"><rect x="-90" y="-30" width="180" height="60" rx="10" fill="#f0fdfa" stroke="#a7f3d0" stroke-width="1"/><text x="0" y="5" text-anchor="middle" font-weight="bold" fill="#047857">提携パートナー</text></g><path d="M 175 75 L 305 75" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="240" y="65" text-anchor="middle" font-size="12" fill="#4b5563">1. 研修費用60万円支払</text><path d="M 310 45 L 170 45" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="240" y="35" text-anchor="middle" font-size="12" fill="#4b5563">2. 研修提供</text><path d="M 495 75 L 625 75" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="560" y="65" text-anchor="middle" font-size="12" fill="#4b5563">3. 助成金申請</text><path d="M 630 105 L 490 105" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="560" y="115" text-anchor="middle" font-size="12" fill="#4b5563">4. 助成金48万円受給</text><path d="M 310 105 L 170 105" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="240" y="115" text-anchor="middle" font-size="12" fill="#4b5563">5. 24万ポイント付与</text><path d="M 100 110 L 100 175 L 305 175" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="200" y="140" text-anchor="middle" font-size="12" fill="#4b5563">6. サービス利用依頼</text><path d="M 310 175 L 305 175" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="350" y="165" text-anchor="middle" font-size="12" fill="#4b5563">7. サービス提供</text></svg></div></div>`
                },
                'program-career-up': {
                    title: 'キャリアアップ助成金 / 減額回避プログラム',
                    contextForAI: 'キャリアアップ助成金（正社員化コース）は2025年度から支給額が半減しますが、当社の研修を受けることで減額を回避し、満額の80万円を受給できるプログラムです。',
                    content: `<div class="bg-emerald-50 border border-emerald-200 p-4 rounded-lg"><h3 class="font-bold text-emerald-700">お客様への伝え方ポイント</h3><ul class="list-disc list-inside mt-2 text-emerald-600 text-sm space-y-1"><li>国の制度変更で、2025年度からキャリアアップ助成金が<strong>80万円から40万円に半減</strong>してしまいます。</li><li>しかし、<strong>有期雇用期間中に当社の研修を受けていただく</strong>だけで、減額される<strong>40万円分（2期目）も受給</strong>できます。</li><li>研修費用は別の助成金で大半が賄えるため、<strong>実質的な追加負担を抑えつつ</strong>、40万円の減額を防ぐことができます。</li></ul></div><div><h3 class="text-xl font-bold text-gray-900 mb-2">プログラム概要</h3><p>2025年度からのキャリアアップ助成金（正社員化コース）の制度変更による支給額減額を、当社の研修プログラムと組み合わせることで回避します。有期雇用期間中に指定の研修を受講することで、減額対象となる2期目の助成金（40万円）も受給可能になります。</p></div><div><h3 class="text-xl font-bold text-gray-900 mb-3">研修の有無による受給額の違い</h3><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="glass-card p-4 rounded-lg"><h4 class="font-bold text-center text-lg mb-2">通常プラン（研修なし）</h4><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 150" class="w-full"><text x="150" y="20" text-anchor="middle" font-size="14" font-weight="bold" fill="#1f2937">受給額: 40万円</text><rect x="50" y="40" width="200" height="30" fill="#fecaca"/><text x="150" y="60" text-anchor="middle" font-size="12" fill="#7f1d1d">手数料 (20%): 8万円</text><rect x="50" y="70" width="160" height="30" fill="#bbf7d0"/><text x="130" y="90" text-anchor="middle" font-size="12" fill="#14532d">お客様受取額: 32万円</text></svg></div><div class="aurora-border rounded-lg"><div class="glass-card p-4 rounded-lg h-full"><h4 class="font-bold text-center text-lg mb-2 text-emerald-600">減額回避プログラム（研修あり）</h4><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 150" class="w-full"><text x="150" y="20" text-anchor="middle" font-size="14" font-weight="bold" fill="#1f2937">受給額合計: 80万円</text><rect x="20" y="40" width="260" height="30" fill="#a7f3d0"/><text x="150" y="60" text-anchor="middle" font-size="12" fill="#047857">1期目(40万) + 2期目加算(40万)</text><rect x="20" y="70" width="220" height="30" fill="#bbf7d0"/><text x="130" y="90" text-anchor="middle" font-size="12" fill="#14532d">お客様受取額: 64万円</text><text x="150" y="125" text-anchor="middle" font-size="12" fill="#4b5563">手数料(16万) - 研修自己負担(12万) = 実質4万円</text></svg></div></div></div></div>`
                },
                'program-human-capital': {
                    title: '人的資本経営 コンサルティング',
                    contextForAI: '人的資本経営コンサルティングは、人材を「資本」として捉え、その価値を最大限に引き出すことで企業価値向上に繋げる支援をします。上場企業には情報開示が義務化されており、投資家からの評価にも直結します。',
                    content: `<div class="bg-emerald-50 border border-emerald-200 p-4 rounded-lg"><h3 class="font-bold text-emerald-700">お客様への伝え方ポイント</h3><ul class="list-disc list-inside mt-2 text-emerald-600 text-sm space-y-1"><li>上場企業では<strong>人的資本の情報開示が義務化</strong>されており、企業の価値を測る新しいモノサシになっています。</li><li>「人」への投資は、<strong>投資家や金融機関からの評価</strong>に直結し、資金調達や企業ブランディングにも有利に働きます。</li><li>当社では、情報開示のサポートから、従業員のエンゲージメントを高める具体的な施策まで、<strong>専門家が一貫してサポート</strong>します。</li></ul></div><div><h3 class="text-xl font-bold text-gray-900 mb-2">プログラム概要</h3><p>人材を「資本」として捉え、その価値を最大限に引き出すことで、中長期的な企業価値向上につなげる経営のあり方（人的資本経営）をコンサルティングします。2023年3月期決算からの情報開示義務化に対応し、企業の持続的成長を支援します。</p></div>`
                },
                'program-keiei-kakushin': {
                    title: '経営革新計画 策定支援',
                    contextForAI: '経営革新計画の策定支援は、新規事業や新サービス開発を対象に、都道府県知事の承認を得るための計画作りをサポートします。承認されると「ものづくり補助金」などで有利になります。リスキリング研修のポイントで策定支援が実質無料になる点が強みです。',
                    content: `<div class="bg-emerald-50 border border-emerald-200 p-4 rounded-lg"><h3 class="font-bold text-emerald-700">お客様への伝え方ポイント</h3><ul class="list-disc list-inside mt-2 text-emerald-600 text-sm space-y-1"><li>新規事業や新サービスをお考えなら、<strong>都道府県知事のお墨付き</strong>がもらえる「経営革新計画」がおすすめです。</li><li>この計画が承認されると、<strong>「ものづくり補助金」などが採択されやすくなる</strong>といったメリットがあります。</li><li>通常50万円の策定支援費用が、<strong>リスキリング研修で得たポイントで実質無料</strong>になります。人材育成と事業計画を同時に進められます。</li></ul></div><div><h3 class="text-xl font-bold text-gray-900 mb-2">プログラム概要</h3><p>既存事業の強みを活かした新規事業や新サービス開発を後押しする「経営革新計画」の策定を支援します。都道府県知事の承認を得ることで、様々なメリットを享受できます。単体での策定支援（50万円）も可能ですが、リスキリング研修と組み合わせることで策定費用をポイント充当し、実質無料で実施できます。</p></div>`
                }
            };
            const navItems = [{id:"home",title:"TOP",type:"main"},{id:"service-menu",title:"Service Menu",type:"main",sub:[{id:"program-point-back",title:"リスキリングスキーム"},{id:"program-career-up",title:"キャリアアップ"},{id:"program-human-capital",title:"人的資本経営"},{id:"program-keiei-kakushin",title:"経営革新計画"}]},{id:"grant-search",title:"助成金・補助金 検索",type:"main"},{id:"point-partners",title:"ポイント利用先一覧",type:"main"},{id:"schedule-generator",title:"スケジュール生成",type:"main"}];
            const originalSectionsHTML = {
                home:`<div class="aurora-border"><div class="glass-card p-8 rounded-2xl"><h2 class="text-3xl font-bold text-gray-900 mb-4">ようこそ、NMCサポートツールへ</h2><p class="mb-6 text-gray-600">このナレッジベースは、営業担当者が助成金・補助金に関する情報を迅速にキャッチアップし、お客様に的確な提案を行うための社内ツールです。</p><div class="bg-emerald-50/50 border border-emerald-200 p-6 rounded-xl"><h3 class="font-bold text-emerald-700 text-lg">ツールの目的</h3><ul class="list-disc list-inside mt-3 text-emerald-800 space-y-2"><li>社内の知識レベルを統一し、誰でもフロント対応ができる状態にする。</li><li>複雑なサービス（ポイント利用、助成金組み合わせ）の理解を促進する。</li><li>顧客からの質問に迅速かつ正確に回答する。</li></ul></div><h3 class="text-2xl font-bold text-gray-900 mt-8 mb-4">よくある質問 (FAQ)</h3><div class="space-y-3"><p><a href="#program-career-up" class="sub-nav-link text-emerald-600 hover:text-emerald-500 transition-all">Q: キャリアアップ助成金が減額されるって本当？どうすれば回避できる？</a></p><p><a href="#program-point-back" class="sub-nav-link text-emerald-600 hover:text-emerald-500 transition-all">Q: 研修を受けるとポイントが貰える仕組みについて教えて。</a></p><p><a href="#grant-search" class="main-nav-link text-emerald-600 hover:text-emerald-500 transition-all">Q: 「助成金」と「補助金」の違いは？</a></p><p><a href="#point-partners" class="main-nav-link text-emerald-600 hover:text-emerald-500 transition-all">Q: 貯まったポイントはどこで使えるの？</a></p></div></div></div>`, 
                'service-menu':`<div class="glass-card p-8 rounded-2xl"><h2 class="text-3xl font-bold text-gray-900 mb-6">Service Menu</h2><div class="border-b border-gray-200"><nav id="program-tabs" class="-mb-px flex flex-wrap gap-x-6" aria-label="Tabs"><button data-tab-target="#program-point-back" class="program-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-900 transition-all active">リスキリングスキーム</button><button data-tab-target="#program-career-up" class="program-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-900 transition-all">キャリアアップ</button><button data-tab-target="#program-human-capital" class="program-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-900 transition-all">人的資本経営</button><button data-tab-target="#program-keiei-kakushin" class="program-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-900 transition-all">経営革新計画</button></nav></div><div class="mt-6"><div id="program-point-back" class="program-tab-panel active space-y-6"></div><div id="program-career-up" class="program-tab-panel space-y-6"></div><div id="program-human-capital" class="program-tab-panel space-y-6"></div><div id="program-keiei-kakushin" class="program-tab-panel space-y-6"></div></div></div>`,
                'grant-search':`<div class="glass-card p-8 rounded-2xl"><h2 class="text-3xl font-bold text-gray-900 mb-6">助成金・補助金 検索</h2><div class="bg-white/50 p-6 rounded-xl border border-gray-200 mb-8"><h3 class="font-bold text-lg text-gray-900 mb-3 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-2 text-emerald-600"><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><path d="M12 17h.01"></path><circle cx="12" cy="12" r="10"></circle></svg>AIアシスタント (β版)</h3><div id="ai-chat-history" class="h-48 overflow-y-auto bg-gray-50 p-3 rounded-md mb-3 border border-gray-200"><div class="ai-chat-bubble self-start bg-gray-200 text-gray-800 p-3 rounded-lg rounded-bl-none"><p class="text-sm">こんにちは！助成金・補助金について何でも聞いてください。<br>例：「ものづくり補助金について教えて」</p></div></div><div class="flex"><input type="text" id="ai-search-input" placeholder="質問を入力してEnter..." class="flex-grow p-3 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-emerald-500 bg-white text-gray-800"><button id="ai-search-btn" class="bg-emerald-600 text-white px-5 py-3 rounded-r-md hover:bg-emerald-500 transition-all">質問</button></div></div><div id="grant-card-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div></div>`,
                "point-partners":`<div class="glass-card p-8 rounded-2xl"><h2 class="text-3xl font-bold text-gray-900 mb-2">ポイント利用先一覧</h2><p class="mb-6 text-gray-500">リスキリングスキームで獲得したポイントは、以下の提携サービスでご利用いただけます。</p><div id="partner-category-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div></div>`,
                "schedule-generator":`<div class="glass-card p-8 rounded-2xl"><h2 class="text-3xl font-bold text-gray-900 mb-2">スケジュールジェネレーター</h2><p class="mb-6 text-gray-500">申請から完了までの大まかなスケジュールを自動生成します。</p><div class="bg-white/50 p-6 rounded-xl border border-gray-200 space-y-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="schedule-type" class="block text-sm font-medium text-gray-700 mb-1">計画の種類</label><select id="schedule-type" class="w-full p-2 border border-gray-300 rounded-md bg-white text-gray-800 focus:ring-emerald-500 focus:border-emerald-500"><option value="keiei-kakushin">経営革新計画</option><option value="career-up">キャリアアップ助成金</option><option value="jinzai-kaihatsu">人材開発支援助成金</option><option value="gyomu-kaizen">業務改善助成金</option></select></div><div id="schedule-inputs"></div></div><div><button id="generate-schedule-btn" class="w-full bg-gradient-to-r from-emerald-500 to-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:opacity-90 transition-all">スケジュールを生成</button></div></div><div id="schedule-output" class="mt-8"></div></div>`
            };
            
            let currentGeminiContext = {};
            let searchTimeout;

            // --- 2. All Function Definitions ---

            function openModal(modalId) {
                const modal = document.getElementById(modalId);
                if (!modal) return;
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    modal.querySelector('.modal-content')?.classList.remove('scale-95');
                }, 10);
            }

            function closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (!modal) return;
                modal.classList.add('opacity-0');
                modal.querySelector('.modal-content')?.classList.add('scale-95');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    document.body.style.overflow = '';
                }, 300);
            }

            function escapeHTML(str) {
                const p = document.createElement("p");
                p.appendChild(document.createTextNode(str));
                return p.innerHTML;
            }

            async function callGeminiAPI(prompt, context) {
                const geminiResponseDiv = document.getElementById('gemini-response');
                geminiResponseDiv.innerHTML = `<div class="flex justify-center items-center h-full"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"></div><p class="ml-4 text-gray-600">Zeroが考えています...</p></div>`;
                
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const systemPrompt = "あなたは「Zero」という名前の、西河マネジメントセンター所属のWEBアプリ専門家・デジタル人材です。常にプロフェッショナルで、先進的かつセンスの良い、事実に忠実なアドバイスをしてください。気さくで親しみやすい口調で、マークダウン形式（**太字**や箇条書き）を活用して分かりやすく回答してください。";
                const userQuery = `${context.contextForAI}\n\n上記のサービス内容を踏まえて、次の質問に答えてください：\n「${prompt}」`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };
                
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    
                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (text) {
                        let html = text
                            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                            .replace(/\n\s*-\s(.*?)/g, '<ul><li>$1</li></ul>')
                            .replace(/<\/ul><ul>/g, '')
                            .replace(/\n/g, '<br>');
                        geminiResponseDiv.innerHTML = `<div class="prose max-w-none text-gray-700">${html}</div>`;
                    } else {
                        throw new Error("No content received from API.");
                    }
                } catch (error) {
                    console.error("Gemini API call failed:", error);
                    geminiResponseDiv.innerHTML = '<p class="text-red-500">申し訳ありません、AIアシスタントからの応答の取得中にエラーが発生しました。</p>';
                }
            }

            function showSection(hash, activateTab = null) {
                document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
                let targetSection = document.querySelector(hash);
                if (!targetSection) {
                    targetSection = document.getElementById('home');
                    hash = '#home';
                }
                targetSection.classList.add('active');

                document.querySelectorAll('#toc a').forEach(link => link.classList.remove('active'));
                const activeLink = document.querySelector(`#toc a[href="${hash}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                    if (activeLink.classList.contains('sub-nav-link')) {
                         const parent = activeLink.closest('div.pl-7');
                         if (parent && parent.previousElementSibling) {
                            parent.previousElementSibling.classList.add('active');
                         }
                    }
                }

                if (activateTab) {
                    const tabButton = document.querySelector(`#service-menu button[data-tab-target="${activateTab}"]`);
                    if (tabButton) {
                        document.querySelectorAll('.program-tab').forEach(t => t.classList.remove('active'));
                        tabButton.classList.add('active');
                        document.querySelectorAll('.program-tab-panel').forEach(p => p.classList.remove('active'));
                        document.querySelector(activateTab)?.classList.add('active');
                    }
                }
            }
            
            function setupGeminiModal() {
                const geminiInput = document.getElementById('gemini-input');
                const geminiSubmit = document.getElementById('gemini-submit');

                const submitQuery = () => {
                    const query = geminiInput.value.trim();
                    if(query) {
                        callGeminiAPI(query, currentGeminiContext);
                        geminiInput.value = '';
                    }
                };

                geminiSubmit.addEventListener('click', submitQuery);
                geminiInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') submitQuery();
                });
            }

            function openJinzaiKaihatsuSimulatorModal() {
                const modalBody = document.getElementById('simulator-modal-body');
                modalBody.innerHTML = `<h2 class="text-2xl font-bold mb-2 text-gray-900">人材開発支援助成金 シミュレーター</h2><p class="mb-6 text-sm text-gray-500">当社のリスキリング研修とポイント制度を活用した場合のメリットを計算します。</p><div class="space-y-4" id="simulator-content-jinzai"></div>`;
                openModal('simulator-modal');
                setupJinzaiKaihatsuSimulator();
            }

            function openGyomukaizenSimulatorModal() {
                const modalBody = document.getElementById('simulator-modal-body');
                modalBody.innerHTML = `<h2 class="text-2xl font-bold mb-2 text-gray-900">業務改善助成金 シミュレーター</h2><p class="mb-6 text-sm text-gray-500">お客様の状況をヒアリングしながら入力することで、対象になるか、いくら受給できるかの目安が分かります。</p><div id="gyomukaizen-sim-wrapper" class="space-y-4"></div>`;
                openModal('simulator-modal');
                setupGyomukaizenSimulator();
            }

            function openCareerUpSimulatorModal() {
                const modalBody = document.getElementById('simulator-modal-body');
                modalBody.innerHTML = `<h2 class="text-2xl font-bold mb-2 text-gray-900">キャリアアップ助成金 シミュレーター</h2><p class="mb-6 text-sm text-gray-500">2025年度の制度変更に対応し、研修実施によるメリットをシミュレーションします。</p><div class="space-y-4" id="simulator-content-careerup"></div>`;
                openModal('simulator-modal');
                setupCareerUpSimulator();
            }
            
            function setupJinzaiKaihatsuSimulator() {
                const container = document.getElementById('simulator-content-jinzai');
                if (!container) return;
                container.innerHTML = `<div class="bg-gray-50 p-4 rounded-lg border"><label for="sim-jinzai-employees" class="block text-sm font-medium text-gray-700 mb-1">1. 研修を受講する従業員数</label><input type="number" id="sim-jinzai-employees" placeholder="例: 5" class="w-full p-2 border border-gray-300 rounded-md"></div><div class="bg-gray-50 p-4 rounded-lg border"><label class="block text-sm font-medium text-gray-700 mb-2">2. 企業規模を選択してください</label><select id="sim-jinzai-company-size" class="w-full p-2 border border-gray-300 rounded-md"><option value="sme">中小企業</option><option value="large">大企業</option></select></div><div id="sim-jinzai-result" class="mt-6"></div>`;
                const inputs={employees:document.getElementById("sim-jinzai-employees"),size:document.getElementById("sim-jinzai-company-size")},resultDiv=document.getElementById("sim-jinzai-result");function runJinzaiSimulation(){const numEmployees=parseInt(inputs.employees.value,10)||0,isSME="sme"===inputs.size.value;if(numEmployees<=0)return void(resultDiv.innerHTML="");const trainingFeePerPerson=6e5,grantAmountPerPerson=isSME?48e4:396000,selfPayPerPerson=trainingFeePerPerson-grantAmountPerPerson,pointsPerPerson=24e4,totalTrainingFee=6e5*numEmployees,totalGrant=grantAmountPerPerson*numEmployees,totalSelfPay=selfPayPerPerson*numEmployees,totalPoints=24e4*numEmployees,finalMerit=totalPoints-totalSelfPay;resultDiv.innerHTML=`<div class="bg-emerald-50 border-l-4 border-emerald-500 p-6 rounded-r-lg mt-6"><h3 class="text-xl font-bold text-emerald-800">シミュレーション結果 (${numEmployees}名 / ${isSME?"中小企業":"大企業"})</h3><div class="overflow-x-auto mt-4"><table class="w-full text-left border-collapse"><thead><tr class="border-b"><th class="p-3">項目</th><th class="p-3">単価</th><th class="p-3">合計金額</th></tr></thead><tbody class="text-gray-700"><tr><td class="p-3 border-t">研修費用</td><td class="p-3 border-t">${trainingFeePerPerson.toLocaleString()}円</td><td class="p-3 border-t">${totalTrainingFee.toLocaleString()}円</td></tr><tr class="bg-gray-50"><td class="p-3 border-t font-medium">助成金額</td><td class="p-3 border-t text-green-600">${grantAmountPerPerson.toLocaleString()}円</td><td class="p-3 border-t text-green-600 font-bold">-${totalGrant.toLocaleString()}円</td></tr><tr><td class="p-3 border-t">企業の実質負担額</td><td class="p-3 border-t">${selfPayPerPerson.toLocaleString()}円</td><td class="p-3 border-t font-bold">${totalSelfPay.toLocaleString()}円</td></tr><tr class="bg-gray-50"><td class="p-3 border-t font-medium">付与ポイント</td><td class="p-3 border-t text-blue-600">${pointsPerPerson.toLocaleString()}円分</td><td class="p-3 border-t text-blue-600 font-bold">+${totalPoints.toLocaleString()}円分</td></tr><tr class="bg-emerald-100"><td class="p-3 border-t-2 border-emerald-500 font-bold">最終的な企業のメリット</td><td class="p-3 border-t-2 border-emerald-500"></td><td class="p-3 border-t-2 border-emerald-500 text-emerald-700 font-bold text-lg">${finalMerit.toLocaleString()}円相当</td></tr></tbody></table></div></div><p class="text-xs text-gray-500 mt-4">※上記は当社提供の60万円研修プランに基づく助成額です。</p>`}
                inputs.employees.addEventListener("input",runJinzaiSimulation),inputs.size.addEventListener("change",runJinzaiSimulation);
            }
            function setupGyomukaizenSimulator(){
                const container=document.getElementById("gyomukaizen-sim-wrapper");
                if(!container)return;
                
                const today = new Date();
                const period1_start = new Date('2025-04-14');
                const period1_end = new Date('2025-06-13');
                const period2_start = new Date('2025-06-14');
                const period2_end = new Date('2025-09-30'); // 仮定

                let statusHTML = '';
                if (today >= period2_start && today <= period2_end) {
                    statusHTML = `<div class="bg-green-100 border-l-4 border-green-500 text-green-800 p-4 rounded-md mb-4" role="alert"><p class="font-bold">申請期間中です</p><p>現在、第2期の申請期間内です。（${period2_end.toLocaleDateString('ja-JP')} まで）</p></div>`;
                } else if (today >= period1_start && today <= period1_end) {
                    statusHTML = `<div class="bg-green-100 border-l-4 border-green-500 text-green-800 p-4 rounded-md mb-4" role="alert"><p class="font-bold">申請期間中です</p><p>現在、第1期の申請期間内です。（${period1_end.toLocaleDateString('ja-JP')} まで）</p></div>`;
                } else {
                    statusHTML = `<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded-md mb-4" role="alert"><p class="font-bold">現在は申請期間外です</p><p>次回の募集情報をご確認ください。（参考：前年度 第1期 4/14～6/13, 第2期 6/14～）</p></div>`;
                }
                
                container.innerHTML= statusHTML + `<div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="bg-gray-50 p-4 rounded-lg border"><label for="sim-company-name" class="block text-sm font-medium text-gray-700 mb-1">1. 企業名</label><input type="text" id="sim-company-name" placeholder="株式会社〇〇" class="w-full p-2 border border-gray-300 rounded-md"></div><div class="bg-gray-50 p-4 rounded-lg border"><label for="sim-pref" class="block text-sm font-medium text-gray-700 mb-1">2. 事業場の都道府県</label><select id="sim-pref" class="w-full p-2 border border-gray-300 rounded-md">${Object.keys(minWages).map(p=>`<option value="${p}">${p}</option>`).join("")}</select><p class="text-xs text-gray-500 mt-1">※最低賃金は令和6年度(2024年10月改定)のデータを参照</p></div></div><div class="bg-gray-50 p-4 rounded-lg border"><label for="sim-equipment-details" class="block text-sm font-medium text-gray-700 mb-1">3. 投資予定の設備</label><textarea id="sim-equipment-details" placeholder="例: POSレジシステム、自動釣銭機" class="w-full p-2 border border-gray-300 rounded-md" rows="2"></textarea></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="bg-gray-50 p-4 rounded-lg border"><label for="sim-current-wage" class="block text-sm font-medium text-gray-700 mb-1">4. 現在の最低賃金(時給)</label><input type="number" id="sim-current-wage" placeholder="例: 1050" class="w-full p-2 border border-gray-300 rounded-md"></div><div class="bg-gray-50 p-4 rounded-lg border"><label for="sim-new-wage" class="block text-sm font-medium text-gray-700 mb-1">5. 引上げ後の最低賃金(時給)</label><input type="number" id="sim-new-wage" placeholder="例: 1100" class="w-full p-2 border border-gray-300 rounded-md"></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="bg-gray-50 p-4 rounded-lg border"><label for="sim-employees" class="block text-sm font-medium text-gray-700 mb-1">6. 賃上げ対象者数</label><input type="number" id="sim-employees" placeholder="例: 5" class="w-full p-2 border border-gray-300 rounded-md"></div><div class="bg-gray-50 p-4 rounded-lg border"><label for="sim-investment" class="block text-sm font-medium text-gray-700 mb-1">7. 投資予定額(税抜)</label><input type="number" id="sim-investment" placeholder="例: 800000" class="w-full p-2 border border-gray-300 rounded-md"></div></div><div class="bg-gray-50 p-4 rounded-lg border"><label class="flex items-center"><input type="checkbox" id="sim-gyomu-small-biz" class="form-checkbox h-5 w-5 text-emerald-600 rounded focus:ring-emerald-500"><span class="ml-2 text-sm text-gray-700">事業場規模30人未満ですか？</span></label></div><div id="sim-result" class="mt-6"></div>`;
                const inputs=["sim-pref","sim-current-wage", "sim-new-wage", "sim-employees","sim-investment","sim-company-name","sim-equipment-details", "sim-gyomu-small-biz"];
                function runGyomukaizenSimulation(){
                    const resultDiv=document.getElementById("sim-result");
                    const pref=document.getElementById("sim-pref").value,currentWage=parseInt(document.getElementById("sim-current-wage").value,10)||0,newWage=parseInt(document.getElementById("sim-new-wage").value,10)||0,employees=parseInt(document.getElementById("sim-employees").value,10)||0,investment=parseInt(document.getElementById("sim-investment").value,10)||0,isSmallBiz=document.getElementById("sim-gyomu-small-biz").checked;
                    
                    if(!pref||currentWage<=0||employees<=0||investment<=0||newWage<=currentWage) return void(resultDiv.innerHTML="");

                    const increaseInput = newWage - currentWage;
                    if(increaseInput < 30) return void(resultDiv.innerHTML=`<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4" role="alert"><p>賃金引上げ額が30円以上になるように設定してください。(現在+${increaseInput}円)</p></div>`);

                    const regionalMinWage=minWages[pref],wageDiff=currentWage-regionalMinWage;
                    if(wageDiff>50)return void(resultDiv.innerHTML=`<div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4" role="alert"><p class="font-bold">対象外</p><p>事業場内最低賃金(${currentWage}円)と地域別最低賃金(${regionalMinWage}円)の差が${wageDiff}円です。50円以内である必要があります。</p></div>`);
                    
                    let increaseAmountCourse = '30';
                    if (increaseInput >= 90) increaseAmountCourse = '90';
                    else if (increaseInput >= 60) increaseAmountCourse = '60';
                    else if (increaseInput >= 45) increaseAmountCourse = '45';

                    let employeeGroup="1";employees>=2&&employees<=3?employeeGroup="2-3":employees>=4&&employees<=6?employeeGroup="4-6":employees>=7&&employees<=9?employeeGroup="7-9":employees>=10&&(employeeGroup="10+");
                    const bizSizeType = isSmallBiz ? 'small' : 'large';
                    const maxGrant=1e4*(gyomukaizenCourses[bizSizeType]?.[increaseAmountCourse]?.[employeeGroup]||0),grantRate=currentWage<1e3?.8:.75,calculatedGrant=investment*grantRate,finalGrant=Math.min(calculatedGrant,maxGrant);
                    resultDiv.innerHTML=`<div class="bg-emerald-50 border-l-4 border-emerald-500 p-6 rounded-r-lg mt-6" id="gyomukaizen-result-area"><h3 class="text-xl font-bold text-emerald-800">シミュレーション結果</h3><div class="overflow-x-auto mt-4"><table class="w-full text-left"><tbody><tr class="border-b"><td class="p-2 font-medium">対象可否</td><td class="p-2 text-green-600 font-bold">対象の可能性があります</td></tr><tr class="border-b bg-gray-50"><td class="p-2 font-medium">賃上げ額</td><td class="p-2">${increaseInput}円 <span class="text-xs text-gray-500">(${currentWage.toLocaleString()}円 → ${newWage.toLocaleString()}円)</span></td></tr><tr class="border-b"><td class="p-2 font-medium">助成率</td><td class="p-2">${100*grantRate}%</td></tr><tr class="border-b bg-gray-50"><td class="p-2 font-medium">助成上限額 (コース: ${increaseAmountCourse}円)</td><td class="p-2">${maxGrant.toLocaleString()}円</td></tr><tr class="border-b"><td class="p-2 font-medium">投資額に基づく助成額</td><td class="p-2">${Math.floor(calculatedGrant).toLocaleString()}円</td></tr><tr class="bg-emerald-100"><td class="p-2 font-bold">支給見込額</td><td class="p-2 font-bold text-xl text-emerald-700">${Math.floor(finalGrant).toLocaleString()}円</td></tr></tbody></table></div></div><div class="mt-4"><button id="export-pdf-btn" class="w-full bg-gradient-to-r from-emerald-500 to-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:opacity-90 transition-all flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>PDFを出力</button></div>`;
                    document.getElementById("export-pdf-btn").addEventListener("click",generateGyomukaizenPDF);
                }
                inputs.forEach(id=>document.getElementById(id)?.addEventListener("input",runGyomukaizenSimulation));
            }

            function generateGyomukaizenPDF() {
                const { jsPDF } = window.jspdf;
                const companyName = document.getElementById('sim-company-name').value || '未入力';
                const equipmentDetails = document.getElementById('sim-equipment-details').value || '未入力';
                const resultArea = document.getElementById('gyomukaizen-result-area').cloneNode(true);
                resultArea.style.backgroundColor = 'white'; // PDF background
                
                const pdfContainer = document.createElement('div');
                pdfContainer.style.position = 'absolute';
                pdfContainer.style.left = '-9999px';
                pdfContainer.style.width = '780px'; 
                pdfContainer.style.padding = '20px';
                pdfContainer.style.backgroundColor = 'white';
                pdfContainer.style.color = '#1f2937';
                pdfContainer.style.fontFamily = "'Inter', 'Noto Sans JP', sans-serif";
                
                pdfContainer.innerHTML = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h1 style="font-size: 24px; font-weight: bold; color: #111827;">業務改善助成金 シミュレーション結果</h1>
                        <p style="font-size: 12px; color: #4b5563;">${new Date().toLocaleDateString('ja-JP')} 作成</p>
                    </div>
                    <div style="font-size: 14px; margin-bottom: 15px; padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px;">
                        <p style="margin-bottom: 5px;"><strong>企業名:</strong> ${escapeHTML(companyName)}</p>
                    </div>
                    <div style="font-size: 14px; margin-bottom: 20px; padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px;">
                        <p style="margin-bottom: 5px;"><strong>投資予定の設備:</strong></p>
                        <p style="white-space: pre-wrap;">${escapeHTML(equipmentDetails)}</p>
                    </div>
                `;
                pdfContainer.appendChild(resultArea);
                pdfContainer.innerHTML += `<p style="font-size: 10px; color: #6b7280; text-align: center; margin-top: 20px;">注釈: 本シミュレーターの結果はあくまで目安であり、助成金の支給額を保証する内容ではありません。</p>`;

                document.body.appendChild(pdfContainer);

                const exportButton = document.getElementById('export-pdf-btn');
                const originalButtonText = exportButton.innerHTML;
                exportButton.innerHTML = `<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>PDFを生成中...`;
                exportButton.disabled = true;

                html2canvas(pdfContainer, { scale: 2 }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const imgProps= pdf.getImageProperties(imgData);
                    const imgHeight = (imgProps.height * pdfWidth) / imgProps.width;
                    
                    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, imgHeight);
                    pdf.save(`業務改善助成金シミュレーション_${companyName}.pdf`);

                    document.body.removeChild(pdfContainer);
                    exportButton.innerHTML = originalButtonText;
                    exportButton.disabled = false;
                }).catch(err => {
                    console.error("PDF generation failed:", err);
                    document.body.removeChild(pdfContainer);
                    exportButton.innerHTML = originalButtonText;
                    exportButton.disabled = false;
                    alert("PDFの生成に失敗しました。");
                });
            }

            function setupCareerUpSimulator(){const container=document.getElementById("simulator-content-careerup");if(!container)return;container.innerHTML=`<div class="bg-gray-50 p-4 rounded-lg border"><label for="sim-careerup-employees" class="block text-sm font-medium text-gray-700 mb-1">1. 正社員に転換する従業員数</label><input type="number" id="sim-careerup-employees" value="1" class="w-full p-2 border border-gray-300 rounded-md"></div><div id="sim-careerup-result" class="mt-6"></div>`;const employeeInput=document.getElementById("sim-careerup-employees");function runCareerUpSimulation(){const numEmployees=parseInt(employeeInput.value,10)||0,resultDiv=document.getElementById("sim-careerup-result");if(numEmployees<=0)return void(resultDiv.innerHTML="");const grantNoTraining=4e5*numEmployees,feeNoTraining=.2*grantNoTraining,netNoTraining=grantNoTraining-feeNoTraining,grantWithTraining=8e5*numEmployees,feeWithTraining=.2*grantWithTraining,trainingCost=12e4*numEmployees,netWithTraining=grantWithTraining-feeWithTraining-trainingCost;resultDiv.innerHTML=`<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6"><div class="glass-card rounded-lg p-4"><h4 class="font-bold text-center text-lg mb-2 text-gray-800">通常プラン（研修なし）</h4><ul class="space-y-1 text-sm text-gray-700"><li><strong>助成金額:</strong> ${grantNoTraining.toLocaleString()}円</li><li><strong>手数料 (20%):</strong> -${feeNoTraining.toLocaleString()}円</li><li class="font-bold text-lg border-t border-gray-200 pt-2 mt-2 text-gray-900">お客様受取額: ${netNoTraining.toLocaleString()}円</li></ul></div><div class="aurora-border rounded-lg"><div class="glass-card rounded-lg p-4 h-full"><h4 class="font-bold text-center text-lg mb-2 text-emerald-600">減額回避プログラム（研修あり）</h4><ul class="space-y-1 text-sm text-gray-700"><li><strong>助成金額:</strong> ${grantWithTraining.toLocaleString()}円</li><li><strong>手数料 (20%):</strong> -${feeWithTraining.toLocaleString()}円</li><li><strong>研修自己負担:</strong> -${trainingCost.toLocaleString()}円</li><li class="font-bold text-lg border-t border-gray-200 pt-2 mt-2 text-gray-900">お客様受取額: ${netWithTraining.toLocaleString()}円</li></ul></div></div></div><p class="text-xs text-gray-500 mt-4">※減額回避プログラムは、有期雇用期間中に指定の研修を受講することで2期目の助成金(40万円/人)の対象となる国の要件を活用するものです。</p>`}
                employeeInput.addEventListener("input",runCareerUpSimulation),runCareerUpSimulation()
            }
            
            function renderAllSectionsAndAttachListeners() {
                const mainContent = document.getElementById('main-content');
                const toc = document.getElementById('toc');
                
                mainContent.innerHTML = '';
                toc.innerHTML = '';

                Object.keys(originalSectionsHTML).forEach(id => {
                    const section = document.createElement('section');
                    section.id = id;
                    section.className = 'content-section';
                    section.innerHTML = originalSectionsHTML[id];
                    mainContent.appendChild(section);
                });

                navItems.forEach(item => {
                    let linkHTML = `<a href="#${item.id}" class="main-nav-link block p-2 rounded-md font-medium text-gray-500 hover:text-gray-900 hover:bg-gray-100 transition-all">${item.title}</a>`;
                    if (item.sub) {
                        linkHTML += `<div class="pl-7 mt-1 space-y-1 border-l-2 border-gray-200 ml-3">`;
                        item.sub.forEach(subItem => {
                            linkHTML += `<a href="#${subItem.id}" class="sub-nav-link block text-sm p-2 rounded-md font-medium text-gray-500 hover:text-gray-900 hover:bg-gray-100 transition-all">${subItem.title}</a>`;
                        });
                        linkHTML += `</div>`;
                    }
                    toc.innerHTML += `<div>${linkHTML}</div>`;
                });

                Object.keys(serviceMenuData).forEach(key => {
                    const panel = document.getElementById(key);
                    if (panel) {
                        const data = serviceMenuData[key];
                        panel.innerHTML = data.content + `<div class="mt-6"><button class="gemini-trigger-btn w-full bg-gray-100 text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-200 transition-all" data-service-key="${key}">✨ AIに提案のコツを相談</button></div>`;
                    }
                });
                
                const grantContainer = document.getElementById('grant-card-container');
                if (grantContainer) {
                    grantContainer.innerHTML = '';
                    grantsData.forEach(grant => {
                        const card = document.createElement('div');
                        card.className = 'aurora-border rounded-lg';
                        card.innerHTML = `<div class="grant-card glass-card p-6 rounded-lg cursor-pointer h-full"><div class="flex justify-between items-start"><h3 class="font-bold text-lg text-gray-900 pr-2">${grant.title}</h3><span class="text-xs font-bold ${grant.type === 'joseikin' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'} px-2 py-1 rounded-full">${grant.type === 'joseikin' ? '助成金' : '補助金'}</span></div><p class="text-sm text-gray-600 mt-2">${grant.purpose}</p></div>`;
                        card.querySelector('.grant-card').dataset.grantId = grant.id;
                        grantContainer.appendChild(card);
                    });
                }
                
                const partnerContainer = document.getElementById('partner-category-grid');
                if(partnerContainer) {
                    partnerContainer.innerHTML = Object.entries(partnerServiceData).map(([key, value]) => `
                        <div class="aurora-border rounded-lg">
                            <div class="partner-card glass-card p-6 rounded-lg h-full cursor-pointer" data-modal-id="${key}">
                                <h3 class="text-xl font-bold text-gray-900 mb-2">${value.title}</h3>
                                <p class="text-sm text-gray-500">${value.services.join(' / ')}</p>
                            </div>
                        </div>
                    `).join('');
                }

                attachAllEventListeners();
            }

            function attachAllEventListeners() {
                document.body.addEventListener('click', function(e) {
                    const mainLink = e.target.closest('.main-nav-link, .sub-nav-link');
                    if(mainLink) {
                        e.preventDefault();
                        const targetId = mainLink.getAttribute('href');
                        const isSubNav = mainLink.classList.contains('sub-nav-link');
                        const mainSectionId = isSubNav ? '#service-menu' : targetId;
                        history.pushState({ section: mainSectionId, tab: isSubNav ? targetId : null }, "", targetId);
                        showSection(mainSectionId, isSubNav ? targetId : null);
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        return;
                    }

                    const tabButton = e.target.closest('.program-tab');
                    if (tabButton) {
                        const targetId = tabButton.dataset.tabTarget;
                        history.pushState({ section: '#service-menu', tab: targetId }, "", targetId);
                        showSection('#service-menu', targetId);
                        return;
                    }
                    
                    const grantCard = e.target.closest('.grant-card');
                    if (grantCard) {
                        const grantId = grantCard.dataset.grantId;
                        if (grantId === 'jinzai-kaihatsu') openJinzaiKaihatsuSimulatorModal();
                        else if (grantId === 'gyomukaizen-joseikin') openGyomukaizenSimulatorModal();
                        else if (grantId === 'career-up') openCareerUpSimulatorModal();
                        else alert(`「${grantsData.find(g => g.id === grantId).title}」の詳細表示機能は現在準備中です。`);
                        return;
                    }
                    
                    const partnerCard = e.target.closest('.partner-card');
                    if (partnerCard) {
                        const data = partnerServiceData[partnerCard.dataset.modalId];
                        const modalBody = document.getElementById('modal-body');
                        modalBody.innerHTML = `<h3 class="text-2xl font-bold text-gray-900 mb-4">${data.title}</h3><ul class="list-disc list-inside text-gray-700 space-y-2">${data.services.map(s => `<li>${s}</li>`).join('')}</ul>`;
                        openModal('partner-modal');
                        return;
                    }
                    
                    const geminiTrigger = e.target.closest('.gemini-trigger-btn');
                    if(geminiTrigger) {
                        const serviceKey = geminiTrigger.dataset.serviceKey;
                        currentGeminiContext = serviceMenuData[serviceKey];
                        document.getElementById('gemini-modal-title').textContent = `✨ ${currentGeminiContext.title} - AIアシスタント`;
                        callGeminiAPI("この制度の提案のコツを教えてください。", currentGeminiContext);
                        openModal('gemini-modal');
                        return;
                    }

                    const modalCloseBtn = e.target.closest('.modal-close-btn, #simulator-close-btn');
                    if(modalCloseBtn) {
                        closeModal(modalCloseBtn.closest('.modal-overlay').id);
                        return;
                    }
                });

                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.addEventListener('click', e => {
                        if (e.target === modal) closeModal(modal.id);
                    });
                });
                
                searchInput.addEventListener('input', () => {
                     clearTimeout(searchTimeout);
                     searchTimeout = setTimeout(() => {
                        // search logic...
                     }, 300);
                });
            }

            function main() {
                renderAllSectionsAndAttachListeners();
                const initialHash = window.location.hash || '#home';
                if (initialHash.startsWith('#program-')) {
                    showSection('#service-menu', initialHash);
                } else {
                    showSection(initialHash);
                }
                window.addEventListener('popstate', (e) => {
                    const state = e.state || { section: '#home', tab: null };
                    showSection(state.section, state.tab);
                });
                setupGeminiModal();
            }

            main();
        });
    </script>
</body>
</html>

