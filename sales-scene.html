<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NMC-support tool | 西河マネジメントセンター</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
        }
        .content-section, .program-tab-panel {
            display: none;
        }
        .content-section.active, .program-tab-panel.active {
            display: block;
        }
        .search-highlight {
            background-color: #fde047; /* yellow-300 */
            border-radius: 2px;
        }
        #toc a {
            transition: all 0.2s ease-in-out;
        }
        #toc a:hover {
            transform: translateX(4px);
            color: #2563eb; /* blue-600 */
        }
        .program-tab {
            border-bottom: 2px solid transparent;
        }
        .program-tab.active {
            border-bottom-color: #2563eb; /* blue-600 */
            color: #2563eb;
        }
        .grant-choice-card, .partner-card, .grant-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .grant-choice-card:hover, .partner-card:hover, .grant-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        /* Modal styles */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        /* Timeline styles */
        .timeline-svg text {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
        }
        /* Simulator styles */
        .sim-step {
            transition: opacity 0.5s ease-in-out;
            opacity: 1;
        }
        .sim-step.hidden {
            display: none;
            opacity: 0;
        }
        /* AI Chat styles */
        .ai-chat-bubble {
            max-width: 80%;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Toggle Switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #2563eb;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #2563eb;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="bg-white p-4 rounded-xl shadow-md mb-8 flex items-center justify-between">
            <div>
                <h1 class="text-xl font-bold text-gray-900">NMC-support tool</h1>
                <p class="text-xs text-gray-500">Nishikawa Management Center</p>
            </div>

            <div class="w-full max-w-lg relative">
                 <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <svg class="w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" /></svg>
                </div>
                <input type="text" id="searchInput" placeholder="キーワードでナレッジベース全体を検索..." class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition">
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <aside id="toc-sidebar" class="lg:col-span-1 bg-white p-6 rounded-xl shadow-md h-fit sticky top-8">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h2 class="text-xl font-bold">Table</h2>
                    <button id="toc-toggle" class="text-sm text-gray-500 hover:text-black">[非表示]</button>
                </div>
                <nav id="toc" class="space-y-2">
                    <a href="#home" class="main-nav-link block font-medium text-gray-700 hover:text-blue-600"><span class="w-7 inline-block">01.</span>TOP</a>
                    <div>
                        <a href="#service-menu" class="main-nav-link block font-medium text-gray-700 hover:text-blue-600"><span class="w-7 inline-block">02.</span>Service Menu</a>
                        <div class="pl-7 mt-2 space-y-2 border-l-2 ml-3">
                             <a href="#program-point-back" class="sub-nav-link block text-sm font-medium text-gray-500 hover:text-blue-600">リスキリングスキーム</a>
                             <a href="#program-career-up" class="sub-nav-link block text-sm font-medium text-gray-500 hover:text-blue-600">キャリアアップ</a>
                             <a href="#program-human-capital" class="sub-nav-link block text-sm font-medium text-gray-500 hover:text-blue-600">人的資本経営</a>
                             <a href="#program-keiei-kakushin" class="sub-nav-link block text-sm font-medium text-gray-500 hover:text-blue-600">経営革新計画</a>
                        </div>
                    </div>
                    <a href="#grant-search" class="main-nav-link block font-medium text-gray-700 hover:text-blue-600"><span class="w-7 inline-block">03.</span>助成金・補助金 検索</a>
                    <a href="#point-partners" class="main-nav-link block font-medium text-gray-700 hover:text-blue-600"><span class="w-7 inline-block">04.</span>ポイント利用先一覧</a>
                    <a href="#service-summary" class="main-nav-link block font-medium text-gray-700 hover:text-blue-600"><span class="w-7 inline-block">05.</span>当社事業概要</a>
                    <a href="#schedule-generator" class="main-nav-link block font-medium text-gray-700 hover:text-blue-600"><span class="w-7 inline-block">06.</span>スケジュール生成</a>
                    <a href="#how-to-add" class="main-nav-link block font-medium text-gray-700 hover:text-blue-600"><span class="w-7 inline-block">07.</span>ナレッジの追加方法</a>
                </nav>
            </aside>

            <main id="main-content" class="lg:col-span-3 space-y-8">
                <!-- Content is managed by JS -->
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="partner-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 relative transform scale-95">
            <button class="modal-close-btn absolute top-4 right-4 text-gray-500 hover:text-gray-800">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <div id="modal-body"></div>
        </div>
    </div>
    <div id="simulator-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto relative transform scale-95">
             <button id="simulator-close-btn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <div id="simulator-modal-body" class="p-8">
                <!-- Simulator will be injected here -->
            </div>
        </div>
    </div>


    <script>
        // --- 1. Database and Variables (Constants) ---
        const grantsData = [
            { id: 'jinzai-kaihatsu', type: 'joseikin', title: '人材開発支援助成金', purpose: '労働者の職業能力開発を促進するため、事業主が労働者に対して訓練等を実施した場合に、訓練経費や訓練期間中の賃金の一部等を助成する制度。', target: '雇用保険の適用事業主。', keywords: '人材育成, リスキリング, 職業訓練, OJT, OFF-JT' },
            { id: 'gyomukaizen-joseikin', type: 'joseikin', title: '業務改善助成金', purpose: '事業場内で最も低い賃金（事業場内最低賃金）を引き上げ、設備投資などを行った場合に、その費用の一部を助成する制度。', target: '事業場内最低賃金と地域別最低賃金の差額が50円以内で、事業場規模100人以下の中小企業・小規模事業者。', keywords: '最低賃金引上げ, 設備投資, 生産性向上, 賃上げ' },
            { id: 'career-up', type: 'joseikin', title: 'キャリアアップ助成金', purpose: '非正規雇用の労働者の企業内でのキャリアアップを促進するため、正社員化等の取組を実施した事業主に対して助成する制度。', target: '非正規雇用労働者のキャリアアップに取り組む事業主。', keywords: '正社員化, 非正規雇用, 処遇改善, 人材確保' },
            { id: 'it-hojokin', type: 'hojokin', title: 'IT導入補助金', purpose: '中小企業・小規模事業者の生産性向上を支援するため、ITツール（ソフトウェア、サービス等）の導入費用の一部を補助する制度。', target: '労働生産性の向上を目指す中小企業・小規模事業者。飲食、宿泊、製造、小売など幅広い業種が対象。', keywords: 'DX化, デジタル化, ソフトウェア, クラウド利用, インボイス制度' },
            { id: 'monodukuri-hojokin', type: 'hojokin', title: 'ものづくり補助金', purpose: '革新的な製品・サービスの開発や生産プロセスの改善に必要な設備投資等を支援する制度。', target: '新製品・新サービス開発や、生産性向上に取り組む中小企業・小規模事業者。', keywords: '設備投資, 試作品開発, 新サービス, 生産性向上' },
        ];
        const partnerServiceData = { 'modal-marketing': { title: 'マーケティング & 営業支援', services: ['Sales Marker', 'Recruit Marker', 'デジタル広告', '営業代行各商材'] }, 'modal-creative': { title: 'クリエイティブ & 制作', services: ['コンテンツ制作', 'メールマーケティング'] }, 'modal-consulting': { title: '経営コンサルティング', services: ['飲食店コンサルティング', '税理サービス'] }, 'modal-lifestyle': { title: 'ライフスタイル & その他', services: ['旅行代理店', '最先端がん診断', '内装工事関連', '投資対象商材'] } };
        const minWages = {"北海道": 960, "青森": 898, "岩手": 893, "宮城": 923, "秋田": 897, "山形": 900, "福島": 900, "茨城": 953, "栃木": 954, "群馬": 935, "埼玉": 1028, "千葉": 1026, "東京": 1113, "神奈川": 1112, "新潟": 931, "富山": 948, "石川": 933, "福井": 931, "山梨": 938, "長野": 948, "岐阜": 950, "静岡": 984, "愛知": 1027, "三重": 973, "滋賀": 967, "京都": 1008, "大阪": 1064, "兵庫": 1001, "奈良": 936, "和歌山": 929, "鳥取": 900, "島根": 904, "岡山": 932, "広島": 970, "山口": 928, "徳島": 896, "香川": 918, "愛媛": 897, "高知": 897, "福岡": 941, "佐賀": 900, "長崎": 898, "熊本": 898, "大分": 899, "宮崎": 897, "鹿児島": 897, "沖縄": 896};
        const gyomukaizenCourses = {'30': {'1': 30, '2-3': 50, '4-6': 70, '7-9': 100, '10+': 120},'45': {'1': 45, '2-3': 70, '4-6': 100, '7-9': 150, '10+': 180},'60': {'1': 60, '2-3': 90, '4-6': 150, '7-9': 230, '10+': 300},'90': {'1': 90, '2-3': 150, '4-6': 270, '7-9': 450, '10+': 600}};

        const originalSectionsHTML = {
            home: `<h2 class="text-2xl font-bold mb-4">ようこそ</h2><p class="mb-4">このナレッジベースは、営業担当者が助成金・補助金に関する情報を迅速にキャッチアップし、お客様に的確な提案を行うための社内ツールです。</p><div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg"><h3 class="font-bold text-blue-800">ツールの目的</h3><ul class="list-disc list-inside mt-2 text-blue-700"><li>社内の知識レベルを統一し、誰でもフロント対応ができる状態にする。</li><li>複雑なサービス（ポイント利用、助成金組み合わせ）の理解を促進する。</li><li>顧客からの質問に迅速かつ正確に回答する。</li></ul></div><h3 class="text-xl font-bold mt-6 mb-3">よくある質問 (FAQ)</h3><div class="space-y-2"><p><a href="#program-career-up" class="sub-nav-link text-blue-600 hover:underline">Q: キャリアアップ助成金が減額されるって本当？どうすれば回避できる？</a></p><p><a href="#program-point-back" class="sub-nav-link text-blue-600 hover:underline">Q: 研修を受けるとポイントが貰える仕組みについて教えて。</a></p><p><a href="#grant-search" class="main-nav-link text-blue-600 hover:underline">Q: 「助成金」と「補助金」の違いは？</a></p><p><a href="#point-partners" class="main-nav-link text-blue-600 hover:underline">Q: 貯まったポイントはどこで使えるの？</a></p></div>`,
            'service-menu': `<h2 class="text-2xl font-bold mb-4">Service Menu</h2>
                <div class="border-b border-gray-200">
                    <nav id="program-tabs" class="-mb-px flex flex-wrap" aria-label="Tabs">
                        <button data-tab-target="#program-point-back" class="program-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm active">人材開発支援助成金 / リスキリングスキーム</button>
                        <button data-tab-target="#program-career-up" class="program-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm">キャリアアップ助成金 / 減額回避プログラム</button>
                        <button data-tab-target="#program-human-capital" class="program-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm">人的資本経営 コンサルティング</button>
                        <button data-tab-target="#program-keiei-kakushin" class="program-tab whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm">経営革新計画 策定支援</button>
                    </nav>
                </div>
                <div class="mt-6">
                    <div id="program-point-back" class="program-tab-panel active space-y-6">
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg"><h3 class="font-bold text-blue-800">お客様への伝え方ポイント</h3><ul class="list-disc list-inside mt-2 text-blue-700 text-sm space-y-1"><li>国の助成金を活用するので、<strong>実質12万円の負担</strong>で、従業員に<strong>60万円分</strong>のDX・GX研修を提供できます。</li><li>さらに、実質負担額を上回る<strong>24万円分のポイント</strong>が付与されるので、<strong>差し引き12万円のプラス</strong>になります。</li><li>このポイントを使って、広告やコンサルなど、<strong>事業成長に必要なサービスを実質無料で導入</strong>できます。</li></ul></div>
                        <div><h3 class="text-xl font-bold mb-2">プログラム概要</h3><p>人材開発支援助成金を活用し、従業員のリスキリングと経営投資を同時に実現する当社独自のプログラムです。助成金で研修費用を賄い、さらに事業投資に使えるポイントを受け取ることができます。</p></div>
                        <div><h3 class="text-xl font-bold mb-3">仕組みの図解</h3><div class="w-full overflow-x-auto bg-gray-50 p-4 rounded-lg"><svg viewBox="0 0 800 250" class="w-full min-w-[700px]"><defs><marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#6b7280"/></marker></defs><g transform="translate(100, 75)"><rect x="-70" y="-30" width="140" height="60" rx="10" fill="#fff" stroke="#e5e7eb" stroke-width="2"/><text x="0" y="5" text-anchor="middle" font-weight="bold">お客様</text></g><g transform="translate(400, 75)"><rect x="-90" y="-30" width="180" height="60" rx="10" fill="#dbeafe" stroke="#93c5fd" stroke-width="2"/><text x="0" y="5" text-anchor="middle" font-weight="bold">当社 (NMC)</text></g><g transform="translate(700, 75)"><rect x="-70" y="-30" width="140" height="60" rx="10" fill="#e0f2fe" stroke="#bae6fd" stroke-width="2"/><text x="0" y="5" text-anchor="middle" font-weight="bold">国</text></g><g transform="translate(400, 175)"><rect x="-90" y="-30" width="180" height="60" rx="10" fill="#d1fae5" stroke="#a7f3d0" stroke-width="2"/><text x="0" y="5" text-anchor="middle" font-weight="bold">提携パートナー</text></g><path d="M 175 75 L 305 75" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="240" y="65" text-anchor="middle" font-size="12">1. 研修費用60万円支払</text><path d="M 310 45 L 170 45" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="240" y="35" text-anchor="middle" font-size="12">2. 研修提供</text><path d="M 495 75 L 625 75" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="560" y="65" text-anchor="middle" font-size="12">3. 助成金申請</text><path d="M 630 105 L 490 105" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="560" y="115" text-anchor="middle" font-size="12">4. 助成金48万円受給</text><path d="M 310 105 L 170 105" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="240" y="115" text-anchor="middle" font-size="12">5. 24万ポイント付与</text><path d="M 100 110 L 100 175 L 305 175" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="200" y="140" text-anchor="middle" font-size="12">6. サービス利用依頼</text><path d="M 495 175 L 500 175" fill="none" stroke="#6b7280" stroke-width="2"/><path d="M 310 175 L 305 175" fill="none" stroke="#6b7280" stroke-width="2" marker-end="url(#arrow)"/><text x="350" y="165" text-anchor="middle" font-size="12">7. サービス提供</text></svg></div></div><div class="text-center"><button class="main-nav-link-btn mt-4 bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700 transition" data-href="#point-partners">ポイント利用先を見る →</button></div>
                    </div>
                    <div id="program-career-up" class="program-tab-panel space-y-6">
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg"><h3 class="font-bold text-blue-800">お客様への伝え方ポイント</h3><ul class="list-disc list-inside mt-2 text-blue-700 text-sm space-y-1"><li>国の制度変更で、2025年度からキャリアアップ助成金が<strong>80万円から40万円に半減</strong>してしまいます。</li><li>しかし、<strong>有期雇用期間中に当社の研修を受けていただく</strong>だけで、減額される<strong>40万円分（2期目）も受給</strong>できます。</li><li>研修費用は別の助成金で大半が賄えるため、<strong>実質的な追加負担を抑えつつ</strong>、40万円の減額を防ぐことができます。</li></ul></div>
                        <div><h3 class="text-xl font-bold mb-2">プログラム概要</h3><p>2025年度からのキャリアアップ助成金（正社員化コース）の制度変更による支給額減額を、当社の研修プログラムと組み合わせることで回避します。有期雇用期間中に指定の研修を受講することで、減額対象となる2期目の助成金（40万円）も受給可能になります。</p></div>
                        <div><h3 class="text-xl font-bold mb-3">研修の有無による受給額の違い</h3><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="border rounded-lg p-4 bg-gray-50"><h4 class="font-bold text-center text-lg mb-2">通常プラン（研修なし）</h4><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 150" class="w-full"><text x="150" y="20" text-anchor="middle" font-size="14" font-weight="bold">受給額: 40万円</text><rect x="50" y="40" width="200" height="30" fill="#fca5a5"/><text x="150" y="60" text-anchor="middle" font-size="12" fill="#7f1d1d">手数料 (20%): 8万円</text><rect x="50" y="70" width="160" height="30" fill="#86efac"/><text x="130" y="90" text-anchor="middle" font-size="12" fill="#14532d">お客様受取額: 32万円</text></svg></div><div class="border-2 border-blue-500 rounded-lg p-4 bg-blue-50 relative"><div class="absolute -top-3 -left-3 bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded-full">おすすめ</div><h4 class="font-bold text-center text-lg mb-2 text-blue-800">減額回避プログラム（研修あり）</h4><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 150" class="w-full"><text x="150" y="20" text-anchor="middle" font-size="14" font-weight="bold">受給額合計: 80万円</text><rect x="20" y="40" width="260" height="30" fill="#93c5fd"/><text x="150" y="60" text-anchor="middle" font-size="12" fill="#1e3a8a">1期目(40万) + 2期目加算(40万)</text><rect x="20" y="70" width="220" height="30" fill="#86efac"/><text x="130" y="90" text-anchor="middle" font-size="12" fill="#14532d">お客様受取額: 64万円</text><text x="150" y="125" text-anchor="middle" font-size="12" fill="#4b5563">手数料(16万) - 研修自己負担(12万) = 実質4万円</text></svg></div></div></div>
                    </div>
                    <div id="program-human-capital" class="program-tab-panel space-y-6">
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg"><h3 class="font-bold text-blue-800">お客様への伝え方ポイント</h3><ul class="list-disc list-inside mt-2 text-blue-700 text-sm space-y-1"><li>上場企業では<strong>人的資本の情報開示が義務化</strong>されており、企業の価値を測る新しいモノサシになっています。</li><li>「人」への投資は、<strong>投資家や金融機関からの評価</strong>に直結し、資金調達や企業ブランディングにも有利に働きます。</li><li>当社では、情報開示のサポートから、従業員のエンゲージメントを高める具体的な施策まで、<strong>専門家が一貫してサポート</strong>します。</li></ul></div>
                        <div><h3 class="text-xl font-bold mb-2">プログラム概要</h3><p>人材を「資本」として捉え、その価値を最大限に引き出すことで、中長期的な企業価値向上につなげる経営のあり方（人的資本経営）をコンサルティングします。2023年3月期決算からの情報開示義務化に対応し、企業の持続的成長を支援します。</p></div>
                    </div>
                    <div id="program-keiei-kakushin" class="program-tab-panel space-y-6">
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg"><h3 class="font-bold text-blue-800">お客様への伝え方ポイント</h3><ul class="list-disc list-inside mt-2 text-blue-700 text-sm space-y-1"><li>新規事業や新サービスをお考えなら、<strong>都道府県知事のお墨付き</strong>がもらえる「経営革新計画」がおすすめです。</li><li>この計画が承認されると、<strong>「ものづくり補助金」などが採択されやすくなる</strong>といったメリットがあります。</li><li>通常50万円の策定支援費用が、<strong>リスキリング研修で得たポイントで実質無料</strong>になります。人材育成と事業計画を同時に進められます。</li></ul></div>
                        <div><h3 class="text-xl font-bold mb-2">プログラム概要</h3><p>既存事業の強みを活かした新規事業や新サービス開発を後押しする「経営革新計画」の策定を支援します。都道府県知事の承認を得ることで、様々なメリットを享受できます。単体での策定支援（50万円）も可能ですが、リスキリング研修と組み合わせることで策定費用をポイント充当し、実質無料で実施できます。</p></div>
                        <div><h3 class="text-xl font-bold mb-3">認定後の主なメリット</h3><div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center"><div class="bg-gray-50 p-4 rounded-lg"><svg class="w-10 h-10 mx-auto text-blue-500 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><p class="font-bold text-sm">補助金優先採択</p></div><div class="bg-gray-50 p-4 rounded-lg"><svg class="w-10 h-10 mx-auto text-blue-500 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg><p class="font-bold text-sm">金融支援</p></div><div class="bg-gray-50 p-4 rounded-lg"><svg class="w-10 h-10 mx-auto text-blue-500 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path></svg><p class="font-bold text-sm">公的信頼性向上</p></div><div class="bg-gray-50 p-4 rounded-lg"><svg class="w-10 h-10 mx-auto text-blue-500 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V7.618a1 1 0 01.553-.894L9 4l6 3v8.764a1 1 0 01-.553.894L9 20z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 4v16"></path></svg><p class="font-bold text-sm">事業戦略明確化</p></div></div></div>
                    </div>
                </div>`,
            'grant-search': `<h2 class="text-2xl font-bold mb-4">助成金・補助金 検索</h2><p class="mb-6 text-sm text-gray-600">AIアシスタントに質問するか、下のカードから制度を選択してください。</p><div class="bg-gray-100 p-4 rounded-lg mb-8"><h3 class="font-bold text-lg mb-2 flex items-center"><svg class="w-6 h-6 mr-2 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 002.25-2.25V7.5a2.25 2.25 0 00-2.25-2.25H7.5A2.25 2.25 0 005.25 7.5v9.75a2.25 2.25 0 002.25 2.25z" /></svg>AIアシスタント (β版)</h3><div id="ai-chat-history" class="h-48 overflow-y-auto bg-white p-3 rounded-md mb-2 border"><div class="ai-chat-bubble self-start bg-gray-200 text-gray-800 p-3 rounded-lg rounded-bl-none"><p class="text-sm">こんにちは！助成金・補助金について何でも聞いてください。<br>例：「ものづくり補助金について教えて」</p></div></div><div class="flex"><input type="text" id="ai-search-input" placeholder="質問を入力..." class="flex-grow p-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500"><button id="ai-search-btn" class="bg-blue-600 text-white px-4 py-2 rounded-r-md hover:bg-blue-700 transition">質問する</button></div></div><div id="grant-card-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>`,
            'point-partners': `<h2 class="text-2xl font-bold mb-4">ポイント利用先一覧</h2><p class="mb-6">リスキリングスキームで獲得したポイントは、以下の提携サービスでご利用いただけます。</p><div id="partner-category-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>`,
            'service-summary': `<h2 class="text-2xl font-bold mb-4">当社事業概要</h2><p>ここに事業概要が入ります。</p>`,
            'schedule-generator': `<h2 class="text-2xl font-bold mb-4">スケジュールジェネレーター</h2><p>ここにスケジュールジェネレーターが入ります。</p>`,
            'how-to-add': `<h2 class="text-2xl font-bold mb-4">ナレッジの追加方法</h2><p>ここにナレッジ追加方法が入ります。</p>`
        };

        // --- App Initialization ---
        document.addEventListener('DOMContentLoaded', function () {
            const mainContent = document.getElementById('main-content');
            const searchInput = document.getElementById('searchInput');
            let searchTimeout;

            // --- All Functions Definitions ---
            function showSection(hash, activateTab = null) {
                document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
                let targetSection = document.querySelector(hash);
                if (!targetSection) {
                    targetSection = document.getElementById('home');
                }
                targetSection.classList.add('active');

                if (activateTab) {
                    const tabButton = document.querySelector(`button[data-tab-target="${activateTab}"]`);
                    if (tabButton) {
                        document.querySelectorAll('.program-tab').forEach(t => t.classList.remove('active'));
                        tabButton.classList.add('active');
                        document.querySelectorAll('.program-tab-panel').forEach(p => p.classList.remove('active'));
                        document.querySelector(activateTab)?.classList.add('active');
                    }
                }
            }

            function openModal(modalId) {
                const modal = document.getElementById(modalId);
                if (!modal) return;
                const modalContent = modal.querySelector('.modal-content');
                modal.classList.remove('hidden');
                document.body.classList.add('overflow-hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    if(modalContent) modalContent.classList.remove('scale-95');
                }, 10);
            }

            function closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (!modal) return;
                const modalContent = modal.querySelector('.modal-content');
                modal.classList.add('opacity-0');
                if(modalContent) modalContent.classList.add('scale-95');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    document.body.classList.remove('overflow-hidden');
                }, 300);
            }
            
            function initializeGrantSearch() {
                const container = document.getElementById('grant-card-container');
                if (!container) return;
                container.innerHTML = '';
                grantsData.forEach(grant => {
                    const card = document.createElement('div');
                    card.className = 'grant-card p-4 bg-white rounded-lg border cursor-pointer';
                    card.dataset.grantId = grant.id;
                    const typeLabel = grant.type === 'joseikin' ? '<span class="text-xs font-bold bg-green-100 text-green-800 px-2 py-1 rounded-full">助成金</span>' : '<span class="text-xs font-bold bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">補助金</span>';
                    card.innerHTML = `<div class="flex justify-between items-start"><h3 class="font-bold text-lg text-gray-800 pr-2">${grant.title}</h3>${typeLabel}</div><p class="text-sm text-gray-600 mt-2">${grant.purpose}</p>`;
                    container.appendChild(card);
                });
            }

            function setupAiSearch() {
                const aiInput = document.getElementById('ai-search-input');
                const aiBtn = document.getElementById('ai-search-btn');
                const aiHistory = document.getElementById('ai-chat-history');
                if(!aiInput || !aiBtn || !aiHistory) return;

                const handleSearch = () => {
                    const query = aiInput.value.trim();
                    if (!query) return;
                    const userBubble = document.createElement('div');
                    userBubble.className = 'ai-chat-bubble self-end bg-blue-500 text-white p-3 rounded-lg rounded-br-none mt-2';
                    userBubble.innerHTML = `<p class="text-sm">${escapeHTML(query)}</p>`;
                    aiHistory.appendChild(userBubble);
                    aiInput.value = '';
                    aiHistory.scrollTop = aiHistory.scrollHeight;
                    setTimeout(() => {
                        let response = '申し訳ありません、その情報は見つかりませんでした。';
                        const lowerQuery = query.toLowerCase();
                        const foundGrant = grantsData.find(g => g.title.toLowerCase().includes(lowerQuery) || g.keywords.toLowerCase().includes(lowerQuery));
                        if (foundGrant) {
                            response = `<strong>${foundGrant.title}</strong>ですね。<br><strong>目的:</strong> ${foundGrant.purpose}<br><strong>対象:</strong> ${foundGrant.target}`;
                        }
                        const aiBubble = document.createElement('div');
                        aiBubble.className = 'ai-chat-bubble self-start bg-gray-200 text-gray-800 p-3 rounded-lg rounded-bl-none mt-2';
                        aiBubble.innerHTML = `<p class="text-sm">${response}</p>`;
                        aiHistory.appendChild(aiBubble);
                        aiHistory.scrollTop = aiHistory.scrollHeight;
                    }, 500);
                };
                aiBtn.addEventListener('click', handleSearch);
                aiInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSearch(); });
            }

            function openJinzaiKaihatsuSimulatorModal() {
                const modalBody = document.getElementById('simulator-modal-body');
                modalBody.innerHTML = `<h2 class="text-2xl font-bold mb-2">人材開発支援助成金 シミュレーター</h2><p class="mb-6 text-sm text-gray-600">当社のリスキリング研修とポイント制度を活用した場合のメリットを計算します。</p><div class="space-y-4" id="simulator-content-jinzai"></div>`;
                openModal('simulator-modal');
                setupJinzaiKaihatsuSimulator();
            }

            function openGyomukaizenSimulatorModal() {
                const modalBody = document.getElementById('simulator-modal-body');
                modalBody.innerHTML = `<h2 class="text-2xl font-bold mb-2">業務改善助成金 シミュレーター</h2><p class="mb-6 text-sm text-gray-600">お客様の状況をヒアリングしながら入力することで、対象になるか、いくら受給できるかの目安が分かります。</p><div class="space-y-4" id="simulator-content"></div>`;
                openModal('simulator-modal');
                setupGyomukaizenSimulator();
            }

            function openCareerUpSimulatorModal() {
                const modalBody = document.getElementById('simulator-modal-body');
                modalBody.innerHTML = `<h2 class="text-2xl font-bold mb-2">キャリアアップ助成金 シミュレーター</h2><p class="mb-6 text-sm text-gray-600">2025年度の制度変更に対応し、研修実施によるメリットをシミュレーションします。</p><div class="space-y-4" id="simulator-content-careerup"></div>`;
                openModal('simulator-modal');
                setupCareerUpSimulator();
            }

            function setupJinzaiKaihatsuSimulator() {
                const container = document.getElementById('simulator-content-jinzai');
                if (!container) return;

                container.innerHTML = `
                    <div class="sim-step bg-gray-50 p-4 rounded-lg border">
                        <label for="sim-jinzai-employees" class="block text-sm font-medium text-gray-700 mb-1">1. 研修を受講する従業員数</label>
                        <input type="number" id="sim-jinzai-employees" placeholder="例: 5" class="w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div class="sim-step bg-gray-50 p-4 rounded-lg border">
                        <label class="block text-sm font-medium text-gray-700 mb-2">2. 企業規模を選択してください</label>
                        <select id="sim-jinzai-company-size" class="w-full p-2 border border-gray-300 rounded-md">
                            <option value="sme">中小企業</option>
                            <option value="large">大企業</option>
                        </select>
                    </div>
                    <div id="sim-jinzai-result" class="mt-6"></div>
                `;

                const inputs = {
                    employees: document.getElementById('sim-jinzai-employees'),
                    size: document.getElementById('sim-jinzai-company-size'),
                };
                const resultDiv = document.getElementById('sim-jinzai-result');

                function runJinzaiSimulation() {
                    const numEmployees = parseInt(inputs.employees.value, 10) || 0;
                    const isSME = inputs.size.value === 'sme';

                    if (numEmployees <= 0) {
                        resultDiv.innerHTML = '';
                        return;
                    }

                    const trainingFeePerPerson = 600000;
                    const grantAmountPerPerson = isSME ? 480000 : 396000;
                    const selfPayPerPerson = trainingFeePerPerson - grantAmountPerPerson;
                    const pointsPerPerson = 240000;

                    const totalTrainingFee = trainingFeePerPerson * numEmployees;
                    const totalGrant = grantAmountPerPerson * numEmployees;
                    const totalSelfPay = selfPayPerPerson * numEmployees;
                    const totalPoints = pointsPerPerson * numEmployees;
                    const finalMerit = totalPoints - totalSelfPay;

                    resultDiv.innerHTML = `
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-lg mt-6">
                            <h3 class="text-xl font-bold text-blue-800">シミュレーション結果 (${numEmployees}名 / ${isSME ? '中小企業' : '大企業'})</h3>
                            <div class="overflow-x-auto mt-4">
                                <table class="w-full text-left border-collapse">
                                    <thead><tr class="bg-white"><th class="p-3 border">項目</th><th class="p-3 border">単価</th><th class="p-3 border">合計金額</th></tr></thead>
                                    <tbody>
                                        <tr><td class="p-3 border">研修費用</td><td class="p-3 border">${trainingFeePerPerson.toLocaleString()}円</td><td class="p-3 border">${totalTrainingFee.toLocaleString()}円</td></tr>
                                        <tr class="bg-gray-50"><td class="p-3 border font-medium">助成金額</td><td class="p-3 border text-green-600">${grantAmountPerPerson.toLocaleString()}円</td><td class="p-3 border text-green-600 font-bold">-${totalGrant.toLocaleString()}円</td></tr>
                                        <tr><td class="p-3 border">企業の実質負担額</td><td class="p-3 border">${selfPayPerPerson.toLocaleString()}円</td><td class="p-3 border font-bold">${totalSelfPay.toLocaleString()}円</td></tr>
                                        <tr class="bg-gray-50"><td class="p-3 border font-medium">付与ポイント</td><td class="p-3 border text-blue-600">${pointsPerPerson.toLocaleString()}円分</td><td class="p-3 border text-blue-600 font-bold">+${totalPoints.toLocaleString()}円分</td></tr>
                                        <tr class="bg-yellow-100"><td class="p-3 border font-bold">最終的な企業のメリット</td><td class="p-3 border"></td><td class="p-3 border text-red-600 font-bold text-lg">${finalMerit.toLocaleString()}円相当</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                }
                inputs.employees.addEventListener('input', runJinzaiSimulation);
                inputs.size.addEventListener('change', runJinzaiSimulation);
            }

            function setupGyomukaizenSimulator() { /* ... existing code ... */ }
            function setupCareerUpSimulator() { /* ... existing code ... */ }

            function renderAllSections() {
                mainContent.innerHTML = '';
                Object.keys(originalSectionsHTML).forEach(id => {
                    const section = document.createElement('section');
                    section.id = id;
                    section.className = 'content-section bg-white p-8 rounded-xl shadow-md';
                    section.innerHTML = originalSectionsHTML[id];
                    mainContent.appendChild(section);
                });
                attachAllEventListeners();
            }

            function attachAllEventListeners() {
                document.body.addEventListener('click', function(e) {
                    const link = e.target.closest('a, button');
                    if (!link) return;

                    // Main Nav & Sub Nav
                    if (link.classList.contains('main-nav-link') || link.classList.contains('sub-nav-link')) {
                        e.preventDefault();
                        if (searchInput.value.trim() !== '') {
                            searchInput.value = '';
                            renderAllSections();
                        }
                        const isSubNav = link.classList.contains('sub-nav-link');
                        const targetId = link.getAttribute('href');
                        const mainSectionId = isSubNav ? '#service-menu' : targetId;
                        const tabId = isSubNav ? targetId : null;
                        history.pushState({ section: mainSectionId, tab: tabId }, "", targetId);
                        showSection(mainSectionId, tabId);
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        return;
                    }
                    // Program Tabs
                    if (link.classList.contains('program-tab')) {
                        const targetId = link.dataset.tabTarget;
                        const targetPanel = document.querySelector(targetId);
                        document.querySelectorAll('.program-tab').forEach(t => t.classList.remove('active'));
                        link.classList.add('active');
                        document.querySelectorAll('.program-tab-panel').forEach(panel => panel.classList.remove('active'));
                        if (targetPanel) targetPanel.classList.add('active');
                        return;
                    }
                    // Grant Cards
                    if (link.classList.contains('grant-card')) {
                        const grantId = link.dataset.grantId;
                        if (grantId === 'jinzai-kaihatsu') openJinzaiKaihatsuSimulatorModal();
                        else if (grantId === 'gyomukaizen-joseikin') openGyomukaizenSimulatorModal();
                        else if (grantId === 'career-up') openCareerUpSimulatorModal();
                        else alert(`「${grantsData.find(g => g.id === grantId).title}」の詳細表示機能は現在準備中です。`);
                        return;
                    }
                    // Modals
                    if (link.closest('.modal-close-btn, #simulator-close-btn')) {
                        const modal = link.closest('.modal-overlay');
                        if (modal) closeModal(modal.id);
                        return;
                    }
                    // Button inside Service Menu
                    if (link.classList.contains('main-nav-link-btn')) {
                        const targetId = link.dataset.href;
                        history.pushState({ section: targetId, tab: null }, "", targetId);
                        showSection(targetId);
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        return;
                    }
                });

                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            closeModal(modal.id);
                        }
                    });
                });

                document.getElementById('toc-toggle')?.addEventListener('click', (e) => {
                    const tocNav = document.getElementById('toc');
                    tocNav.classList.toggle('hidden');
                    e.target.textContent = tocNav.classList.contains('hidden') ? '[表示]' : '[非表示]';
                });
                
                initializeGrantSearch();
                setupAiSearch();
            }

            function escapeHTML(str) { const p = document.createElement("p"); p.appendChild(document.createTextNode(str)); return p.innerHTML; }

            // --- Initial Load ---
            renderAllSections();
            const initialHash = window.location.hash;
            if (initialHash.startsWith('#program-')) {
                showSection('#service-menu', initialHash);
            } else {
                showSection(initialHash || '#home');
            }
            
            // --- Global Search ---
            searchInput.addEventListener('input', function () {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const query = this.value.trim();
                    renderAllSections(); 
                    
                    if (query === '') {
                        const currentHash = window.location.hash;
                         if (currentHash.startsWith('#program-')) {
                            showSection('#service-menu', currentHash);
                        } else {
                            showSection(currentHash || '#home');
                        }
                        return;
                    }
                    
                    document.querySelectorAll('.content-section').forEach(section => section.classList.add('active'));
                    
                    const regex = new RegExp(query, 'gi');
                    let matchFound = false;
                    document.querySelectorAll('#main-content .content-section').forEach(element => {
                        const textNodes = (function getTextNodes(node) { let textNodes = []; if (node.nodeType === 3) { if (node.nodeValue.trim() !== '') textNodes.push(node); } else { for (let i = 0, len = node.childNodes.length; i < len; ++i) { textNodes = textNodes.concat(getTextNodes(node.childNodes[i])); } } return textNodes; })(element);
                        
                        let sectionHasMatch = false;
                        textNodes.forEach(node => {
                            if (node.nodeValue.match(regex)) {
                                matchFound = true;
                                sectionHasMatch = true;
                                const newNode = document.createElement('span');
                                newNode.innerHTML = node.nodeValue.replace(regex, `<span class="search-highlight">$&</span>`);
                                node.parentNode.replaceChild(newNode, node);
                            }
                        });
                        if (!sectionHasMatch) {
                            element.classList.remove('active');
                        }
                    });
                    if (!matchFound) {
                        mainContent.innerHTML = `<div class="bg-white p-8 rounded-xl shadow-md"><p class="text-center text-gray-600">「${escapeHTML(query)}」に一致する情報は見つかりませんでした。</p></div>`;
                    }
                }, 300);
            });

            // --- Popstate for browser navigation ---
            window.addEventListener('popstate', (e) => {
                renderAllSections();
                const state = e.state || { section: '#home', tab: null };
                showSection(state.section, state.tab);
            });
        });
    </script>
</body>
</html>
